id: chatroom-v1
draft: false
version: 0.0.11
routes:
  - method: Options
    path: /v1/rooms/{room-name}/join
    binding:
      bindingType: cors-preflight
  - method: Post
    path: /v1/rooms/{room-name}/join
    binding:
      type: wit-worker
      componentId:
        componentId: f26bee92-2773-4f9d-bb9e-ab7a91e2c19f
        version: 0
      response: |
        let worker-name: string = request.path.room-name;
        let worker = instance(worker-name);
        let user: string = request.body.user_id;
        worker.join(user);
        {status: 200}

  - method: Options
    path: /v1/rooms/{room-name}/messages
    binding:
      bindingType: cors-preflight
  - method: Post
    path: /v1/rooms/{room-name}/messages
    binding:
      type: wit-worker
      componentId:
        componentId: f26bee92-2773-4f9d-bb9e-ab7a91e2c19f
        version: 0
      response: |
        let worker-name: string = request.path.room-name;
        let worker = instance(worker-name);
        let user: string = request.body.user_id;
        let message: string = request.body.message;
        worker.send(user, message);
        {status: 200}

  - method: Options
    path: /v1/inboxes/{user-id}/messages?{after}&{limit}
    binding:
      bindingType: cors-preflight
  - method: Get
    path: /v1/inboxes/{user-id}/messages?{after}&{limit}
    binding:
      type: wit-worker
      componentId:
        componentId: 99572d2b-1a32-4381-93e1-fb8560f7260e
        version: 0
      response: |
        let user-id: string = request.path.user-id;
        let worker = instance(user-id);
        let after: u64 = request.path.after;
        let limit: u8 = request.path.limit;
        let response = worker.poll-messages(after, limit);
        let body = { messages: response };
        {status: 200, body: body }
