id: chatroom-v1
draft: false
version: 0.0.9
routes:
  - method: Post
    path: "/v1/rooms/{room-name}/join"
    binding:
      type: wit-worker
      componentId:
        componentId: "856fe6c9-b7b0-4d26-ba62-4343f83502b4"
        version: 0
      # worker-name: |
      #   request.path.room-name
      response: |
        let worker-name: string = request.path.room-name;
        let worker = instance(worker-name);
        let user: string = request.body.user_id;
        worker.join(user);
        {status: 200}
  - method: Post
    path: "/v1/rooms/{room-name}/messages"
    binding:
      type: wit-worker
      componentId:
        componentId: "856fe6c9-b7b0-4d26-ba62-4343f83502b4"
        version: 0
      # worker-name: |
      #   request.path.room-name
      response: |
        let worker-name: string = request.path.room-name;
        let worker = instance(worker-name);
        let user: string = request.body.user_id;
        let message: string = request.body.message;
        worker.send(user, message);
        {status: 200}
  - method: Get
    path: "/v1/inboxes/{user-id}/messages?{after}&{limit}"
    binding:
      type: wit-worker
      componentId:
        componentId: "a31bc8aa-3489-4e5e-93c9-fb137acad781"
        version: 0
      response: |
        let user-id: string = request.path.user-id;
        let worker = instance(user-id);
        let after: u64 = request.path.after;
        let limit: u8 = request.path.limit;
        let response = worker.poll-messages(after, limit);
        let body = { messages: response };
        {status: 200, body: body }
