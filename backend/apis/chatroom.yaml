id: chatroom-v1
draft: false
version: 0.0.14
routes:
  - method: Options
    path: /v1/rooms/{room-name}/join
    binding:
      bindingType: cors-preflight
  - method: Post
    path: /v1/rooms/{room-name}/join
    binding:
      type: wit-worker
      componentId:
        componentId: 8668db93-be43-4971-889b-6df1eff90a69
        version: 0
      response: |
        let worker-name: string = request.path.room-name;
        let worker = instance(worker-name);
        let user: string = request.body.user_id;
        worker.join(user);
        {status: 200}

  - method: Options
    path: /v1/rooms/{room-name}/messages
    binding:
      bindingType: cors-preflight
  - method: Post
    path: /v1/rooms/{room-name}/messages
    binding:
      type: wit-worker
      componentId:
        componentId: 8668db93-be43-4971-889b-6df1eff90a69
        version: 0
      response: |
        let worker-name: string = request.path.room-name;
        let worker = instance(worker-name);
        let user: string = request.body.user_id;
        let message: string = request.body.message;
        worker.send(user, message);
        {status: 200}

  - method: Options
    path: /v1/inboxes/{user-id}/messages?{from}&{limit}
    binding:
      bindingType: cors-preflight
  - method: Get
    path: /v1/inboxes/{user-id}/messages?{from}&{limit}
    binding:
      type: wit-worker
      componentId:
        componentId: cc54a0f3-5d2b-4881-aca6-01af5facd0c4
        version: 0
      response: |
        let user-id: string = request.path.user-id;
        let worker = instance(user-id);
        let from: u64 = request.path.from;
        let limit: u8 = request.path.limit;
        let response = worker.poll-messages(from, limit);
        let body = { messages: response };
        {status: 200, body: body }
